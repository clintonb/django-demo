sudo: required

services:
  - docker

language: python

python:
  - 3.6

cache: pip

env:
  global:
    # Docker credentials
    - secure: "RMctVg8e9XsG5pzhtDSZgcNT07HawaaEx35k7bSc5/xcSt6RSg+4T3LKsLw5LH0yHQ+c7NDqv55NGeQA/7JoNeCRXGjuSWB+NazaxvtIGV7oLsIFWztIh50KD/9mZDI37rrxlV6J/KYedE4nguyOBobi0lXmaypu9s9frWjo9vrii7weDTGb6dKAoAAxb2Dtd96yzOHenOR/5BjunKc/kAglrPdJS/3pLCBKkOb9BW/5ZQefEoris1e42RvjMYdN9mzU31iGa4thQk48wdk3CvQsZpg9nkqN53DM/7aO6GXZVg5mc289rGC5hCvOqYGbsNUkH6PmQCvNJXBcbOZBd0wJXwVfKNUufG/Xut83+5RSRP6ZcZkxPhbYa7HqMIBJmrWkF8P9s+qR82BGzDyfPXmR1kBZn7CexQXpHTzmW5ouCaYSL+UpM6fvZwEPeJ9mfP5be3xwtBk8iyN/TRP9MQiDGY7ZHowm9WqKcL0SrUAh9h3gYLUtbPlh0EbFOl9ejY78OCRx/jcPS4Cy2IWEmUKNOHWXJN4laFzNO2k2rDHYwbTlQjjNpRt0wVc21ghJxmCD+WcRg2otF6pyfhk+VMphpyxUFArrBNREWswiZepLkdLN9yBNFi5CQpYGrqQr2Q3AVsjLgkZQJbBWq8NPRtemtDvv6xsOCMGpc9nV8bA="
    - secure: "U1Q++HKYwlsQrNrkMiClxr4oIqfdFxnlbvfxeZX5qgKTNND5bjZcnSwZWOiFVTItuxS4sJuqKcqb3EJLqgu5HnsDtL80Gb2CKJBdjCUQHaI+DCjU1gYxk7icqIrXOODC4PEyESA8qpzWnQxutH+Lz41QcKCwOHCnR6qwJILMadohOQ4w5uOS5hNHsNTN7REGGu5+H6nZnHsdKw7q7o8TcgwJ4oY9n8KAIycDrRo0VCnXdwy5sqAfdW2fG9aJM6THX+7EuUfnv1v5Pgfi8kwbjWcVibw1K4MGntOgCk/tZNeP77XFbc+ZqsHPhObHD/6NLBqa8TbvCBl0MFrHGyzP9PIGhgqrIwnwWqek1NvnKEm77kznGyuxhYTkD+jdJUPgMpmoLOOSJWxkji6k4TGO7krdy05hWGCrvrLhw5KSyqjMBRqq5jwo2JwmFZNAcuQ1i3jsCRVnRj2X87EFRn8mC4NDbQjypDFPHRORbSlzBrugsm15NyIWWoOnCgO7pZ/62EI1yPsOutdcB6nC4Yuo0iWFtOV4U0pv2TRDRbT16KjjQ/02vVBaRBKkbkKfbTxNFRJdXiAQVwhpWbpjN3UPhvKuIOksGjoPMwMUxjV95VHPXPbEvFBttK7VknmXP/Ap3tQQXBJgQdpmlsCUXZOi0GrSjuTI8Qdk1K/ZgkMeGVQ="

    # AWS credentials
    - secure: "JpSK3SRJMlvmEYp5rm3lBoUsf0Sg7ObXGiJQ0d6RIatBe/ZaYscrq6xTHzSvOP8rjgpdg51ICKC3Y66NF8zOkey6Gc4afiuZcODeNB67trdYsziOrjJyLVc5DLdwLcniWxk7ce1SB953x36TcX9JoaPK+7gGSiEM0E/ZxxIXyF0CrTp2L963WWOsUvjXX2qodsvRe7Y/6FFl/WttODrcl6NS6FKNUhRccfOFiXC0MZYDvogwUWFdCnne9VMJEkyO+sQk7Mv5SYRdOQG/WFQkZA5/F6YNl7sG7Ykqhn/HRzGlr92Q3zsla5KWpkRcMK8QKOZNwPl91u3Gt8sNCjMXDTpg5uvjeZrKaf8cWGaZkyGaUj7w2Su4CX63OKjxrDiiaEG8Ais67NuRW6hTDmy9CdpwVqK8NaGzlYuq/4A4gEk9gqHlf0aBmMmJTaMpbfY7RPecc8n32v9ca46UhKL9LTeBabNxKaIGEtlOidPzccmbfZ6TtccdiukBm9nfVzTNVLI6wbuxESkgfn2i5vQssH4i8xR9UjUqBSI+HZSz9FYGiDZGCTsX2z2jNVkOrTe1+V3wMBEDoBvXBztXkt0+X8t4d1JMckI+kGVsN8QP8VyO1zqGeaFGjOnRDb5HpcthqCM1txWRvnSbwnkIqDppYLJpZPSdIIHp6V9Dswwbu6c="
    - secure: "JLAXhInNcU8hNZ/CxQLhM4tvCWGssnB7VGBwM3KePqFhoi3k5qQVU77V23ev430aFMS01RJ77Zl2mi+jXTIbotzpJcc46qWtuQPPF013C1sRZwFLKUuJ1RWojsArWfnCYLwxiqB28MCVOTG2YedI+i5lSGROo3z1nCnxe/M/6USlUPbAFRefNdZDS1Ptd6HfpzvRLCytvWVZ2ybUykZhta6K40Xt3KyF6tKaM7tEpSwTA9D6XjWg+ns7RbFmBTqub2jzsgHLbHQOb2fsJyaGoW4ta6oL7jK1K+01GPvwQqcxXGzgrAPnoJzCjmXbJFyviKO5yIFcNDybKOhn8g+8pIGuUwOLMQLnjHoZGprgPpj7jBiCwYRJbCvUBcQcjZGDfJskarRNSyqwLOcp629uDrIdgLTrVxxotewEEiGOLH7IzWPpB0G4fake/g6kfVd4k/+vaILXRJtWfAmg3Ja0lgxe/gN2vheeFlLuzvrBXlWyG+ssxY6a4x3HCkdZr9xoy9kHRtg1Ftb43zOrebNFmE4dRw+u+PWJN8AefZqn6evYJUxybPgWqiDAfmeo2At61y9zEAb/UYOWHMsC8xJOqzk9f6pWrfjZSgvEoSqt+rThr+Pr4QVjUlljf4kxPOoFHaUnsOBfsnm3lH94zCy9RWVyspfVWh0yAq4fIf2lhiY="

script:
  - make docker.build
  - make local.up
  - sleep 5
  - docker exec -t django_demo.app make quality
  - docker exec -t django_demo.app make static
  - docker exec -t django_demo.app make test

after_success:
  - pip install -U codecov
  - docker exec -t django_demo.app coverage xml
  - codecov

before_deploy:
  - pip install -U awsebcli

deploy:
  - provider: script
    script: bash .travis/docker_push.sh
    on:
      branch: master
  - provider: script
    script: bash .travis/eb_deploy.sh
    on:
      branch: master
