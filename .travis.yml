sudo: required

services:
  - docker

language: python

python:
  - 3.6

cache: pip

env:
  global:
    - secure: "RMctVg8e9XsG5pzhtDSZgcNT07HawaaEx35k7bSc5/xcSt6RSg+4T3LKsLw5LH0yHQ+c7NDqv55NGeQA/7JoNeCRXGjuSWB+NazaxvtIGV7oLsIFWztIh50KD/9mZDI37rrxlV6J/KYedE4nguyOBobi0lXmaypu9s9frWjo9vrii7weDTGb6dKAoAAxb2Dtd96yzOHenOR/5BjunKc/kAglrPdJS/3pLCBKkOb9BW/5ZQefEoris1e42RvjMYdN9mzU31iGa4thQk48wdk3CvQsZpg9nkqN53DM/7aO6GXZVg5mc289rGC5hCvOqYGbsNUkH6PmQCvNJXBcbOZBd0wJXwVfKNUufG/Xut83+5RSRP6ZcZkxPhbYa7HqMIBJmrWkF8P9s+qR82BGzDyfPXmR1kBZn7CexQXpHTzmW5ouCaYSL+UpM6fvZwEPeJ9mfP5be3xwtBk8iyN/TRP9MQiDGY7ZHowm9WqKcL0SrUAh9h3gYLUtbPlh0EbFOl9ejY78OCRx/jcPS4Cy2IWEmUKNOHWXJN4laFzNO2k2rDHYwbTlQjjNpRt0wVc21ghJxmCD+WcRg2otF6pyfhk+VMphpyxUFArrBNREWswiZepLkdLN9yBNFi5CQpYGrqQr2Q3AVsjLgkZQJbBWq8NPRtemtDvv6xsOCMGpc9nV8bA="
    - secure: "U1Q++HKYwlsQrNrkMiClxr4oIqfdFxnlbvfxeZX5qgKTNND5bjZcnSwZWOiFVTItuxS4sJuqKcqb3EJLqgu5HnsDtL80Gb2CKJBdjCUQHaI+DCjU1gYxk7icqIrXOODC4PEyESA8qpzWnQxutH+Lz41QcKCwOHCnR6qwJILMadohOQ4w5uOS5hNHsNTN7REGGu5+H6nZnHsdKw7q7o8TcgwJ4oY9n8KAIycDrRo0VCnXdwy5sqAfdW2fG9aJM6THX+7EuUfnv1v5Pgfi8kwbjWcVibw1K4MGntOgCk/tZNeP77XFbc+ZqsHPhObHD/6NLBqa8TbvCBl0MFrHGyzP9PIGhgqrIwnwWqek1NvnKEm77kznGyuxhYTkD+jdJUPgMpmoLOOSJWxkji6k4TGO7krdy05hWGCrvrLhw5KSyqjMBRqq5jwo2JwmFZNAcuQ1i3jsCRVnRj2X87EFRn8mC4NDbQjypDFPHRORbSlzBrugsm15NyIWWoOnCgO7pZ/62EI1yPsOutdcB6nC4Yuo0iWFtOV4U0pv2TRDRbT16KjjQ/02vVBaRBKkbkKfbTxNFRJdXiAQVwhpWbpjN3UPhvKuIOksGjoPMwMUxjV95VHPXPbEvFBttK7VknmXP/Ap3tQQXBJgQdpmlsCUXZOi0GrSjuTI8Qdk1K/ZgkMeGVQ="

script:
  - make docker.build
  - make local.up
  - sleep 5
  - docker exec -t django_demo.app make quality
  - docker exec -t django_demo.app make static
  - docker exec -t django_demo.app make test

after_success:
  - pip install -U codecov
  - docker exec -t django_demo.app coverage xml
  - codecov

deploy:
  - provider: script
    script: bash .travis/docker_push.sh
    on:
      branch: master
  - provider: elasticbeanstalk
    # User has AWSElasticBeanstalkService role
    access_key_id: AKIAIBOZTACVTZLI5WSQ
    secret_access_key:
      secure: Wqbr8V3dykYhQnTA+3PTnXew9QvnVE9vNl0UBtoTaQwMNIfpXfIYuFJuzuhuHLmzaIk+MRsPD9NxY/y2OEngll58AruOrz6FFIFFJCqJWXM+0V2s8HcCKRyMWICXdJQicDFN1ge34pP/cuby5lVfHSq7rlTv5shr5cGJ0Ynwwlv2P8vw2o2LcoS2AQCwQpE73rkvXKLvHV+ahi8SDZAQltaPRvxCzEhbPESWfDA6Qdpk3YsVxCFrerKOqm0dauxv3wa6IEg/EUECPPRq1bG47D3m+iFivVecpurQT7UBWXx99zeHxxgaJ3x4Gvt+K4nqON2U3s933JR9hWGrfqKG66HEaqy5Yg8F2HSszY5SKeF7qNUT4ZbadU7eZZdfiI0IWMYzads4q9h6s+qAcb+Pky2kFyaukjCB+yg4HAryLtUL96wpINGqsVePgqBe3G/hVBmccIXXPgVdY4ShszuJle2+n4v0x8BdaFhCr9wzospNKgj6MMC7/wUXM6oBoWOHClyan4rucxjpXeGq/jTVJS1Uwsn6c43FnSBSpVEnLtKGiXBqwH4+zyociPWvS8PAyu4wTLkq36WQeB9m9relDseKed8SD5geBBhMBiXb0c51jDC0AeiyicYlaJqMKZCu68uNjlU2yNQQZJvWBpnBn52l2UTA+sL2Pa/QW5a0Wls=
    region: us-west-2
    app: django-demo
    env: production
    bucket_name: elasticbeanstalk-us-west-2-102034828053
    on:
      branch: master
